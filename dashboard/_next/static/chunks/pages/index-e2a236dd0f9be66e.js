(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{48312:function(e,t,l){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return l(45256)}])},45256:function(e,t,l){"use strict";l.r(t),l.d(t,{__N_SSG:function(){return e0},default:function(){return eQ}});var r,a,s=l(85893),n=l(67294),o=l(61162),i=l(9008),d=l.n(i);let c=e=>{let{initialState:t}=e,l=(e,l)=>{if(!l.type)return{...e,[l.field]:l.value};if("reset"===l.type)return t;throw Error()},[r,a]=(0,n.useReducer)(l,t);return(0,n.useMemo)(()=>({state:r,dispatch:a}),[r,a])};var u=l(83454);let m=()=>{let e=async e=>{let t="".concat(e.url,"/v1/models");try{let l=await fetch(t,{headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e.key?e.key:u.env.OPENAI_API_KEY)}}),r=await l.json(),a=r.data;if(a&&a.length>0)return a.map(e=>(-1===e.id.indexOf(":")||e.name||(e.name=e.id.split(":")[1],e.id=e.id.split(":")[0]),e));return[]}catch(e){return{}}};return{getModels:e}};(r=a||(a={})).GPT_3_5="gpt-3.5-turbo",r.LLAMA_2_CHAT="llama-2-chat",r.GPT_3_5_AZ="gpt-35-turbo",r.GPT_4="gpt-4",r.GPT_4_32K="gpt-4-32k",a.LLAMA_2_CHAT;let x={[a.GPT_3_5]:{id:a.GPT_3_5,name:"GPT-3.5",maxLength:12e3,tokenLimit:4e3},[a.LLAMA_2_CHAT]:{id:a.LLAMA_2_CHAT,name:"LLAMA_2_CHAT",maxLength:12e3,tokenLimit:4e3},[a.GPT_3_5_AZ]:{id:a.GPT_3_5_AZ,name:"GPT-3.5",maxLength:12e3,tokenLimit:4e3},[a.GPT_4]:{id:a.GPT_4,name:"GPT-4",maxLength:24e3,tokenLimit:8e3},[a.GPT_4_32K]:{id:a.GPT_4_32K,name:"GPT-4-32K",maxLength:96e3,tokenLimit:32e3}};var p=l(83454);p.env.NEXT_PUBLIC_DEFAULT_SYSTEM_PROMPT,p.env.OPENAI_API_HOST;let h=parseFloat(p.env.NEXT_PUBLIC_DEFAULT_TEMPERATURE||"1"),g=p.env.OPENAI_API_TYPE||"openai";p.env.OPENAI_API_VERSION,p.env.OPENAI_ORGANIZATION,p.env.AZURE_DEPLOYMENT_ID;let v=e=>{let t=e;return t.model||(t={...t,model:t.model||x[a.GPT_3_5]}),t.temperature||(t={...t,temperature:t.temperature||h}),t.folderId||(t={...t,folderId:t.folderId||null}),t.messages||(t={...t,messages:t.messages||[]}),t},f=e=>Array.isArray(e)?e.reduce((e,t)=>{try{t.model||(t.model=x[a.GPT_3_5]),t.temperature||(t.temperature=h),t.folderId||(t.folderId=null),t.messages||(t.messages=[]),e.push(t)}catch(e){console.warn("error while cleaning conversations' history. Removing culprit",e)}return e},[]):(console.warn("history is not an array. Returning an empty array."),[]),b=(e,t)=>{let l=t.map(t=>t.id===e.id?e:t);return w(e),y(l),{single:e,all:l}},w=e=>{localStorage.setItem("selectedConversation",JSON.stringify(e))},y=e=>{localStorage.setItem("conversationHistory",JSON.stringify(e))},j=e=>{localStorage.setItem("folders",JSON.stringify(e))},k=e=>{localStorage.setItem("prompts",JSON.stringify(e))},N="settings",C=()=>{let e={theme:"dark",isStream:!0},t=localStorage.getItem(N);if(t)try{let l=JSON.parse(t);e=Object.assign(e,l)}catch(e){console.error(e)}return e},S=e=>{localStorage.setItem(N,JSON.stringify(e))};var I=l(33111),L=l(51668);let _=(0,n.createContext)(void 0);var E=l(30904),A=l(20487),P=l(59348),T=l(23461),z=l(63072);let O=e=>{let{prompts:t,activePromptIndex:l,onSelect:r,onMouseOver:a,promptListRef:n}=e;return(0,s.jsx)("ul",{ref:n,className:"z-10 max-h-52 w-full overflow-scroll rounded border border-black/10 bg-white shadow-[0_0_10px_rgba(0,0,0,0.10)] dark:border-neutral-500 dark:bg-[#343541] dark:text-white dark:shadow-[0_0_15px_rgba(0,0,0,0.10)]",children:t.map((e,t)=>(0,s.jsx)("li",{className:"".concat(t===l?"bg-gray-200 dark:bg-[#202123] dark:text-black":""," cursor-pointer px-3 py-2 text-sm text-black dark:text-white"),onClick:e=>{e.preventDefault(),e.stopPropagation(),r()},onMouseEnter:()=>a(t),children:e.name},e.id))})},Z=e=>{let{prompt:t,variables:l,onSubmit:r,onClose:a}=e,[o,i]=(0,n.useState)(l.map(e=>({key:e,value:""})).filter((e,t,l)=>l.findIndex(t=>t.key===e.key)===t)),d=(0,n.useRef)(null),c=(0,n.useRef)(null),u=(e,t)=>{i(l=>{let r=[...l];return r[e].value=t,r})},m=()=>{if(o.some(e=>""===e.value)){alert("Please fill out all variables");return}r(o.map(e=>e.value)),a()},x=e=>{"Enter"!==e.key||e.shiftKey?"Escape"===e.key&&a():(e.preventDefault(),m())};return(0,n.useEffect)(()=>{let e=e=>{d.current&&!d.current.contains(e.target)&&a()};return window.addEventListener("click",e),()=>{window.removeEventListener("click",e)}},[a]),(0,n.useEffect)(()=>{c.current&&c.current.focus()},[]),(0,s.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onKeyDown:x,children:(0,s.jsxs)("div",{ref:d,className:"dark:border-netural-400 inline-block max-h-[400px] transform overflow-y-auto rounded-lg border border-gray-300 bg-white px-4 pt-5 pb-4 text-left align-bottom shadow-xl transition-all dark:bg-[#202123] sm:my-8 sm:max-h-[600px] sm:w-full sm:max-w-lg sm:p-6 sm:align-middle",role:"dialog",children:[(0,s.jsx)("div",{className:"mb-4 text-xl font-bold text-black dark:text-neutral-200",children:t.name}),(0,s.jsx)("div",{className:"mb-4 text-sm italic text-black dark:text-neutral-200",children:t.description}),o.map((e,t)=>(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("div",{className:"mb-2 text-sm font-bold text-neutral-200",children:e.key}),(0,s.jsx)("textarea",{ref:0===t?c:void 0,className:"mt-1 w-full rounded-lg border border-neutral-500 px-4 py-2 text-neutral-900 shadow focus:outline-none dark:border-neutral-800 dark:border-opacity-50 dark:bg-[#40414F] dark:text-neutral-100",style:{resize:"none"},placeholder:"Enter a value for ".concat(e.key,"..."),value:e.value,onChange:e=>u(t,e.target.value),rows:3})]},t)),(0,s.jsx)("button",{className:"mt-6 w-full rounded-lg border border-neutral-500 px-4 py-2 text-neutral-900 shadow hover:bg-neutral-100 focus:outline-none dark:border-neutral-800 dark:border-opacity-50 dark:bg-white dark:text-black dark:hover:bg-neutral-300",onClick:m,children:"Submit"})]})})},D=e=>{var t;let{onSend:l,onRegenerate:r,maxImg:a,onScrollDownClick:i,stopConversationRef:d,textareaRef:c,showScrollDownButton:u}=e,{t:m}=(0,o.$G)("chat"),{state:{selectedConversation:x,messageIsStreaming:p,prompts:h},dispatch:g}=(0,n.useContext)(_),[v,f]=(0,n.useState)(),[b,w]=(0,n.useState)(!1),[y,j]=(0,n.useState)(!1),[k,N]=(0,n.useState)(0),[C,S]=(0,n.useState)(""),[I,L]=(0,n.useState)([]),[D,R]=(0,n.useState)(!1),[G,K]=(0,n.useState)(!1),[M,J]=(0,n.useState)(null),[U,H]=(0,n.useState)(!1),[F,$]=(0,n.useState)(""),B=(0,n.useRef)(null),Y=h.filter(e=>e.name.toLowerCase().includes(C.toLowerCase())),W=e=>{let t=e.target.value,l=null==x?void 0:x.model.maxLength;if(l&&t.length>l){alert(m("Message limit is {{maxLength}} characters. You have entered {{valueLength}} characters.",{maxLength:l,valueLength:t.length}));return}f(t),et(t)},X=()=>{let e=ea;if(U&&(e=ed()),p)return;if(!v){alert(m("Please enter a message"));return}let t=v;e.length>0&&(t=[{type:"text",text:v}],e.forEach(e=>{Array.isArray(t)&&t.push({type:"image_url",image_url:{url:e}})})),l({role:"user",content:t},M),f(""),es([]),J(null),window.innerWidth<640&&c&&c.current&&c.current.blur()},V=()=>{let e=void 0===window.navigator?"":navigator.userAgent;return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|Mobile|mobile|CriOS/i.test(e)},q=()=>{let e=Y[k];e&&(f(t=>null==t?void 0:t.replace(/\/\w*$/,e.content)),el(e)),j(!1)},Q=e=>{y?"ArrowDown"===e.key?(e.preventDefault(),N(e=>e<h.length-1?e+1:e)):"ArrowUp"===e.key?(e.preventDefault(),N(e=>e>0?e-1:e)):"Tab"===e.key?(e.preventDefault(),N(e=>e<h.length-1?e+1:0)):"Enter"===e.key?(e.preventDefault(),q()):"Escape"===e.key?(e.preventDefault(),j(!1)):N(0):"Enter"!==e.key||b||V()||e.shiftKey?"/"===e.key&&e.metaKey&&(e.preventDefault(),K(!G)):(e.preventDefault(),X())},ee=e=>{let t;let l=/{{(.*?)}}/g,r=[];for(;null!==(t=l.exec(e));)r.push(t[1]);return r},et=(0,n.useCallback)(e=>{let t=e.match(/\/\w*$/);t?(j(!0),S(t[0].slice(1))):(j(!1),S(""))},[]),el=e=>{let t=ee(e.content);L(t),t.length>0?R(!0):(f(t=>null==t?void 0:t.replace(/\/\w*$/,e.content)),et(e.content))},er=e=>{let t=null==v?void 0:v.replace(/{{(.*?)}}/g,(t,l)=>{let r=I.indexOf(l);return e[r]});f(t),c&&c.current&&c.current.focus()};(0,n.useEffect)(()=>{B.current&&(B.current.scrollTop=30*k)},[k]),(0,n.useEffect)(()=>{if(c&&c.current){var e,t;c.current.style.height="inherit",c.current.style.height="".concat(null===(e=c.current)||void 0===e?void 0:e.scrollHeight,"px"),c.current.style.overflow="".concat((null==c?void 0:null===(t=c.current)||void 0===t?void 0:t.scrollHeight)>400?"auto":"hidden")}},[v]),(0,n.useEffect)(()=>{let e=e=>{B.current&&!B.current.contains(e.target)&&j(!1)};return window.addEventListener("click",e),()=>{window.removeEventListener("click",e)}},[]);let[ea,es]=(0,n.useState)([]),en=e=>{let t=e.target.files;if(t){let e=[],l=[];for(let r=0;r<t.length;r++){let a=t[r],s=new FileReader;l.push(new Promise(t=>{s.onloadend=()=>{e.push(s.result),t()}})),s.readAsDataURL(a)}Promise.all(l).then(()=>{eo(e)})}},eo=e=>{let t;if(ea.length+e.length<=a)t=[...ea,...e];else{let l=[...e,...e];t=l.slice(-a)}return es(t),t},ei=e=>{es(t=>{let l=[...t];return l.splice(e,1),l})},ed=()=>{let e=[];return H(!1),F&&(e=eo([F]),$("")),e};return(0,s.jsxs)("div",{className:"absolute bottom-0 left-0 w-full border-transparent bg-gradient-to-b from-transparent via-white to-white pt-6 dark:border-white/20 dark:via-[#343541] dark:to-[#343541] md:pt-2",children:[(0,s.jsx)("input",{type:"file",accept:"image/*",onChange:en,style:{display:"none"},id:"upload-button"}),(0,s.jsx)("div",{className:"lg:mx-auto lg:max-w-3xl mx-2 md:mx-4 mt-4 md:mt-[52px] ",children:(0,s.jsx)("div",{className:"flex justify-start"+(ea.length>0?" mt-4":""),children:(0,s.jsxs)("div",{className:"text-black flex items-center p-2 mx-2 sm:mx-4 w-full rounded-t-md bg-white border-black/10 dark:text-white dark:border-gray-900/50 dark:bg-[#40414f] border-t border-x",children:[(0,s.jsx)("button",{title:"upload image file(coming soon)",disabled:0===a,className:"p-2 mr-2 bg-[#ececec] dark:bg-[#343541] rounded-lg"+(0===a?" cursor-not-allowed":""),onClick:()=>{var e;null===(e=document.getElementById("upload-button"))||void 0===e||e.click()},children:(0,s.jsx)(E.Z,{size:20})}),U?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("input",{onChange:e=>{$(e.target.value)},id:"imgUrlInputBox",autoFocus:!0,style:{height:"2.25rem"},className:"px-2 h-full bg-[#ececec] dark:bg-[#343541] rounded-l-lg"}),(0,s.jsx)("button",{title:"upload",className:"p-2 bg-[#ececec] dark:bg-[#343541] rounded-r-lg",onClick:ed,children:F?"Submit":"Close"})]}):(0,s.jsx)("button",{disabled:0===a,title:"Upload images by entering the url",className:"p-2 bg-[#ececec] dark:bg-[#343541] rounded-lg"+(0===a?" cursor-not-allowed":""),onClick:()=>{H(!0)},children:(0,s.jsx)(A.Z,{size:20})}),(0,s.jsx)("div",{className:"ml-4 "+(0===a?"block":"hidden"),children:"For Llava series models, please submit an image URL for processing first."})]})})}),(0,s.jsx)("div",{className:"stretch mx-2 flex flex-row gap-3 last:mb-2 md:mx-4 md:last:mb-6 lg:mx-auto lg:max-w-3xl",children:(0,s.jsxs)("div",{className:"relative mx-2 flex w-full flex-grow flex-col rounded-b-md border border-black/10 bg-white shadow-[0_0_10px_rgba(0,0,0,0.10)] dark:border-gray-900/50 dark:bg-[#40414F] dark:text-white dark:shadow-[0_0_15px_rgba(0,0,0,0.10)] sm:mx-4",children:[(0,s.jsx)("div",{className:"absolute left-2 top-2 rounded-sm p-1 text-neutral-800 opacity-60 dark:bg-opacity-50 dark:text-neutral-100",children:(0,s.jsx)(P.Z,{size:20})}),(0,s.jsx)("textarea",{ref:c,className:"m-0 w-full resize-none border-0 bg-transparent p-0 py-2 pr-8 pl-10 text-black dark:bg-transparent dark:text-white md:py-3 md:pl-10",style:{resize:"none",bottom:"".concat(null==c?void 0:null===(t=c.current)||void 0===t?void 0:t.scrollHeight,"px"),maxHeight:"400px",overflow:"".concat(c.current&&c.current.scrollHeight>400?"auto":"hidden")},placeholder:m('Type a message or type "/" to select a prompt...')||"",value:v,rows:1,onCompositionStart:()=>w(!0),onCompositionEnd:()=>w(!1),onChange:W,onKeyDown:Q}),(0,s.jsx)("button",{className:"absolute right-2 top-2 rounded-sm p-1 text-neutral-800 opacity-60 hover:bg-neutral-200 hover:text-neutral-900 dark:bg-opacity-50 dark:text-neutral-100 dark:hover:text-neutral-200",onClick:X,children:p?(0,s.jsx)("div",{className:"h-4 w-4 animate-spin rounded-full border-t-2 border-neutral-800 opacity-60 dark:border-neutral-100"}):(0,s.jsx)(T.Z,{size:18})}),u&&(0,s.jsx)("div",{className:"absolute bottom-12 right-0 lg:bottom-0 lg:-right-10",children:(0,s.jsx)("button",{className:"flex h-7 w-7 items-center justify-center rounded-full bg-neutral-300 text-gray-800 shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-neutral-200",onClick:i,children:(0,s.jsx)(z.Z,{size:18})})}),y&&Y.length>0&&(0,s.jsx)("div",{className:"absolute bottom-12 w-full",children:(0,s.jsx)(O,{activePromptIndex:k,prompts:Y,onSelect:q,onMouseOver:N,promptListRef:B})}),D&&(0,s.jsx)(Z,{prompt:Y[k],variables:I,onSubmit:er,onClose:()=>R(!1)})]})}),(0,s.jsx)("div",{className:"lg:mx-auto lg:max-w-3xl",children:(0,s.jsx)("div",{className:"flex mx-2 sm:mx-4"+(ea.length>0?" mt-4":""),children:ea.map((e,t)=>(0,s.jsx)("div",{style:{position:"relative",display:"inline-block",marginRight:"10px"},children:(0,s.jsxs)("div",{style:{width:"100px",height:"100px",borderRadius:"5px",border:"1px dashed #ccc",overflow:"hidden",position:"relative"},children:[(0,s.jsx)("img",{src:e,alt:"Uploaded",style:{width:"100%",height:"100%",objectFit:"cover"}}),(0,s.jsx)("div",{style:{position:"absolute",top:"5px",right:"5px",cursor:"pointer"},onClick:()=>ei(t),children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-x-circle",viewBox:"0 0 16 16",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14zM7.354 8l-2.88 2.879a.5.5 0 0 1-.708-.708L6.646 8 3.766 5.121a.5.5 0 0 1 .708-.708L8 7.354l2.879-2.88a.5.5 0 0 1 .708.708L8.354 8l2.879 2.879a.5.5 0 0 1-.708.708L8 8.354 5.121 11.233a.5.5 0 0 1-.708-.708L7.354 8z"})})})]})},t))})}),(0,s.jsxs)("div",{className:"px-3 pt-2 pb-3 text-center text-[12px] text-black/50 dark:text-white/50 md:px-4 md:pt-3 md:pb-6",children:[(0,s.jsx)("span",{children:"Based on "}),(0,s.jsx)("a",{href:"https://github.com/second-state/chatbot-ui",target:"_blank",rel:"noreferrer",className:"underline",children:"chatbot-ui"})]})]})};var R=l(90553);let G=()=>(0,s.jsx)("div",{className:"group border-b border-black/10 bg-gray-50 text-gray-800 dark:border-gray-900/50 dark:bg-[#444654] dark:text-gray-100",style:{overflowWrap:"anywhere"},children:(0,s.jsxs)("div",{className:"m-auto flex gap-4 p-4 text-base md:max-w-2xl md:gap-6 md:py-6 lg:max-w-2xl lg:px-0 xl:max-w-3xl",children:[(0,s.jsx)("div",{className:"min-w-[40px] items-end",children:(0,s.jsx)(R.Z,{size:30})}),(0,s.jsx)("span",{className:"animate-pulse cursor-default mt-1",children:"▍"})]})}),K=e=>{let{size:t="1em",className:l=""}=e;return(0,s.jsxs)("svg",{stroke:"currentColor",fill:"none",strokeWidth:"2",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",className:"animate-spin ".concat(l),height:t,width:t,xmlns:"http://www.w3.org/2000/svg",children:[(0,s.jsx)("line",{x1:"12",y1:"2",x2:"12",y2:"6"}),(0,s.jsx)("line",{x1:"12",y1:"18",x2:"12",y2:"22"}),(0,s.jsx)("line",{x1:"4.93",y1:"4.93",x2:"7.76",y2:"7.76"}),(0,s.jsx)("line",{x1:"16.24",y1:"16.24",x2:"19.07",y2:"19.07"}),(0,s.jsx)("line",{x1:"2",y1:"12",x2:"6",y2:"12"}),(0,s.jsx)("line",{x1:"18",y1:"12",x2:"22",y2:"12"}),(0,s.jsx)("line",{x1:"4.93",y1:"19.07",x2:"7.76",y2:"16.24"}),(0,s.jsx)("line",{x1:"16.24",y1:"7.76",x2:"19.07",y2:"4.93"})]})};var M=l(58403);let J=e=>{let{error:t}=e;return(0,s.jsxs)("div",{className:"mx-6 flex h-full flex-col items-center justify-center text-red-500",children:[(0,s.jsx)("div",{className:"mb-5",children:(0,s.jsx)(M.Z,{size:36})}),(0,s.jsx)("div",{className:"mb-3 text-2xl font-medium",children:t.title}),t.messageLines.map((e,t)=>(0,s.jsxs)("div",{className:"text-center",children:[" ",e," "]},t)),(0,s.jsx)("div",{className:"mt-4 text-xs opacity-50 dark:text-red-400",children:t.code?(0,s.jsxs)("i",{children:["Code: ",t.code]}):""})]})},U=[{id:"llama-2-chat",description:"",content:"You are a helpful, respectful and honest assistant. Always answer as short as possible, while being safe.",controlState:0},{id:"codellama-instruct",description:"",content:"You are a helpful, respectful and honest assistant. Always answer as short as possible, while being safe.",controlState:0},{id:"vicuna-chat",description:"",content:"You are a helpful, respectful and honest assistant. Always answer as short as possible, while being safe.",controlState:0},{id:"chatml",description:"",content:"Answer as concisely as possible.",controlState:1},{id:"mistral-instruct-v0.1",description:"",content:"",controlState:2},{id:"belle-llama-2-chat",description:"",content:"",controlState:2}],H=()=>{var e;let{t}=(0,o.$G)("chat"),{state:{selectedConversation:l,models:r,defaultModelId:a},handleUpdateConversationAll:i,dispatch:d}=(0,n.useContext)(_);return(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("label",{className:"mb-2 text-left text-neutral-700 dark:text-neutral-400",children:t("Model")}),(0,s.jsx)("div",{className:"w-full rounded-lg border border-neutral-200 bg-transparent pr-2 text-neutral-900 dark:border-neutral-600 dark:text-white",children:(0,s.jsx)("div",{className:"w-full p-2",children:(null==l?void 0:null===(e=l.model)||void 0===e?void 0:e.id)||a})})]})},F=e=>{var t;let{conversation:l,prompts:r,onChangePrompt:a}=e,{t:i}=(0,o.$G)("chat"),[d,c]=(0,n.useState)(""),[u,m]=(0,n.useState)(0),[x,p]=(0,n.useState)(!1),[h,g]=(0,n.useState)(""),[v,f]=(0,n.useState)([]),[b,w]=(0,n.useState)(!1),y=(0,n.useRef)(null),j=(0,n.useRef)(null),k=r.filter(e=>e.name.toLowerCase().includes(h.toLowerCase())),N=e=>{let t=e.target.value,r=l.model.maxLength;if(t.length>r){alert(i("Prompt limit is {{maxLength}} characters. You have entered {{valueLength}} characters.",{maxLength:r,valueLength:t.length}));return}c(t),I(t),a(t)},C=()=>{let e=k[u];c(t=>{let l=null==t?void 0:t.replace(/\/\w*$/,e.content);return l}),L(e),p(!1)},S=e=>{let t;let l=/{{(.*?)}}/g,r=[];for(;null!==(t=l.exec(e));)r.push(t[1]);return r},I=(0,n.useCallback)(e=>{let t=e.match(/\/\w*$/);t?(p(!0),g(t[0].slice(1))):(p(!1),g(""))},[]),L=e=>{let t=S(e.content);if(f(t),t.length>0)w(!0);else{let t=null==d?void 0:d.replace(/\/\w*$/,e.content);c(t),a(t),I(e.content)}},_=e=>{let t=null==d?void 0:d.replace(/{{(.*?)}}/g,(t,l)=>{let r=v.indexOf(l);return e[r]});c(t),a(t),y&&y.current&&y.current.focus()},E=e=>{x&&("ArrowDown"===e.key?(e.preventDefault(),m(e=>e<r.length-1?e+1:e)):"ArrowUp"===e.key?(e.preventDefault(),m(e=>e>0?e-1:e)):"Tab"===e.key?(e.preventDefault(),m(e=>e<r.length-1?e+1:0)):"Enter"===e.key?(e.preventDefault(),C()):"Escape"===e.key?(e.preventDefault(),p(!1)):m(0))};return(0,n.useEffect)(()=>{if(y&&y.current){var e;y.current.style.height="inherit",y.current.style.height="".concat(null===(e=y.current)||void 0===e?void 0:e.scrollHeight,"px")}},[d]),(0,n.useEffect)(()=>{c(l.prompt||"")},[l.prompt]),(0,n.useEffect)(()=>{let e=e=>{j.current&&!j.current.contains(e.target)&&p(!1)};return window.addEventListener("click",e),()=>{window.removeEventListener("click",e)}},[]),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("label",{className:"mb-2 text-left text-neutral-700 dark:text-neutral-400",children:i("System Prompt")}),(0,s.jsx)("textarea",{ref:y,className:"w-full rounded-lg border border-neutral-200 bg-transparent px-4 py-3 text-neutral-900 dark:border-neutral-600 dark:text-neutral-100",style:{borderColor:"".concat(d||1!==l.promptState?"":"red"),resize:"none",bottom:"".concat(null==y?void 0:null===(t=y.current)||void 0===t?void 0:t.scrollHeight,"px"),maxHeight:"300px",overflow:"".concat(y.current&&y.current.scrollHeight>400?"auto":"hidden")},placeholder:i('Enter a prompt or type "/" to select a prompt...')||"",value:d||"",rows:1,onChange:N,onKeyDown:E}),!d&&1===l.promptState&&(0,s.jsx)("div",{style:{color:"red",marginTop:"2px"},children:"The prompt of this model cannot be empty!"}),x&&k.length>0&&(0,s.jsx)("div",{children:(0,s.jsx)(O,{activePromptIndex:u,prompts:k,onSelect:C,onMouseOver:m,promptListRef:j})}),b&&(0,s.jsx)(Z,{prompt:r[u],variables:v,onSubmit:_,onClose:()=>w(!1)})]})};var $=l(8861),B=l(21942),Y=l(74075),W=l(24888),X=l(88198),V=l(93625),q=l(67828),Q=l(80335),ee=l(93179),et=l(84283);let el={javascript:".js",python:".py",java:".java",c:".c",cpp:".cpp","c++":".cpp","c#":".cs",ruby:".rb",php:".php",swift:".swift","objective-c":".m",kotlin:".kt",typescript:".ts",go:".go",perl:".pl",rust:".rs",scala:".scala",haskell:".hs",lua:".lua",shell:".sh",sql:".sql",html:".html",css:".css"},er=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l="ABCDEFGHJKLMNPQRSTUVWXY3456789",r="";for(let t=0;t<e;t++)r+=l.charAt(Math.floor(Math.random()*l.length));return t?r.toLowerCase():r},ea=(0,n.memo)(e=>{let{language:t,value:l}=e,{t:r}=(0,o.$G)("markdown"),[a,i]=(0,n.useState)(!1),d=()=>{navigator.clipboard&&navigator.clipboard.writeText&&navigator.clipboard.writeText(l).then(()=>{i(!0),setTimeout(()=>{i(!1)},2e3)})},c=()=>{let e=el[t]||".file",a="file-".concat(er(3,!0)).concat(e),s=window.prompt(r("Enter file name")||"",a);if(!s)return;let n=new Blob([l],{type:"text/plain"}),o=URL.createObjectURL(n),i=document.createElement("a");i.download=s,i.href=o,i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(o)};return(0,s.jsxs)("div",{className:"codeblock relative font-sans text-[16px]",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between py-1.5 px-4",children:[(0,s.jsx)("span",{className:"text-xs lowercase text-white",children:t}),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsxs)("button",{className:"flex gap-1.5 items-center rounded bg-none p-1 text-xs text-white",onClick:d,children:[a?(0,s.jsx)(X.Z,{size:18}):(0,s.jsx)(q.Z,{size:18}),a?r("Copied!"):r("Copy code")]}),(0,s.jsx)("button",{className:"flex items-center rounded bg-none p-1 text-xs text-white",onClick:c,children:(0,s.jsx)(Q.Z,{size:18})})]})]}),(0,s.jsx)(ee.Z,{language:t,style:et.vk,customStyle:{margin:0},children:l})]})});ea.displayName="CodeBlock";var es=l(97495);let en=(0,n.memo)(es.D,(e,t)=>e.children===t.children);var eo=l(69232),ei=l(14769),ed=l(30399);let ec=(0,n.memo)(e=>{var t;let{message:l,maxImg:r,messageIndex:a,onRegenerate:i,onEdit:d}=e,{t:c}=(0,o.$G)("chat"),{state:{selectedConversation:u,conversations:m,currentMessage:x,messageIsStreaming:p},dispatch:h}=(0,n.useContext)(_),[g,v]=(0,n.useState)(!1),[f,w]=(0,n.useState)(!1),[y,j]=(0,n.useState)(""),[k,N]=(0,n.useState)([]),[C,S]=(0,n.useState)(!1),I=(0,n.useRef)(null),L=()=>{v(!g)},E=e=>{j(e.target.value),I.current&&(I.current.style.height="inherit",I.current.style.height="".concat(I.current.scrollHeight,"px"))},A=()=>{let e=!1,t=!1,r=y,a=z(l.content);k.length>0?((0===a.imgList.length||k.length!==a.imgList.length)&&(t=!0),a.text!==y&&(e=!0),r=[{type:"text",text:y}],k.forEach((e,l)=>{t||e===a.imgList[l]||(t=!0),Array.isArray(r)&&r.push({type:"image_url",image_url:{url:e}})})):(a.imgList.length>0&&(t=!0),l.content!=y&&(e=!0)),(e||t)&&u&&d&&d({...l,content:r}),v(!1)},P=()=>{if(!u)return;let{messages:e}=u,t=e.findIndex(e=>e===l);if(t<0)return;t<e.length-1&&"assistant"===e[t+1].role?e.splice(t,2):e.splice(t,1);let r={...u,messages:e},{single:a,all:s}=b(r,m);h({field:"selectedConversation",value:a}),h({field:"conversations",value:s})},T=e=>{"Enter"!==e.key||f||e.shiftKey||(e.preventDefault(),A())},z=e=>{let t="",l=[];return Array.isArray(e)?e.forEach(e=>{"text"===e.type?t=e.text||"":"image_url"===e.type&&e.image_url&&l.push(e.image_url.url)}):t=e,{text:t,imgList:l}},O=()=>{navigator.clipboard&&navigator.clipboard.writeText(z(l.content).text).then(()=>{S(!0),setTimeout(()=>{S(!1)},2e3)})},Z=e=>{let t=z(e);N(t.imgList),j(t.text)};(0,n.useEffect)(()=>{Z(l.content)},[l.content]),(0,n.useEffect)(()=>{I.current&&(I.current.style.height="inherit",I.current.style.height="".concat(I.current.scrollHeight,"px"))},[g]);let D=e=>{k.length+e.length<=r?N(t=>[...t,...e]):N(t=>{let l=[...t,...e];return l.slice(-r)})},G=e=>{let t=e.target.files;if(t){let e=[],l=[];for(let r=0;r<t.length;r++){let a=t[r],s=new FileReader;l.push(new Promise(t=>{s.onloadend=()=>{e.push(s.result),t()}})),s.readAsDataURL(a)}Promise.all(l).then(()=>{D(e)})}},K=e=>{N(t=>{let l=[...t];return l.splice(e,1),l})};return(0,s.jsx)("div",{className:"group md:px-4 ".concat("assistant"===l.role?"border-b border-black/10 bg-gray-50 text-gray-800 dark:border-gray-900/50 dark:bg-[#444654] dark:text-gray-100":"border-b border-black/10 bg-white text-gray-800 dark:border-gray-900/50 dark:bg-[#343541] dark:text-gray-100"),style:{overflowWrap:"anywhere"},children:(0,s.jsxs)("div",{className:"relative m-auto flex p-4 text-base md:max-w-2xl md:gap-6 md:py-6 lg:max-w-2xl lg:px-0 xl:max-w-3xl",children:[(0,s.jsx)("div",{className:"min-w-[40px] text-right font-bold",children:"assistant"===l.role?(0,s.jsx)(R.Z,{size:30}):(0,s.jsx)($.Z,{size:30})}),(0,s.jsx)("div",{className:"prose mt-[-2px] w-full dark:prose-invert",children:"user"===l.role?(0,s.jsxs)("div",{className:"flex w-full",children:[g?(0,s.jsxs)("div",{className:"flex w-full flex-col",children:[(0,s.jsx)("textarea",{ref:I,className:"w-full resize-none whitespace-pre-wrap border-none dark:bg-[#343541]",value:y,onChange:E,onKeyDown:T,onCompositionStart:()=>w(!0),onCompositionEnd:()=>w(!1),style:{fontFamily:"inherit",fontSize:"inherit",lineHeight:"inherit",padding:"0",margin:"0",overflow:"hidden"}}),(0,s.jsxs)("div",{className:"flex",children:[k.map((e,t)=>(0,s.jsx)("div",{style:{position:"relative",display:"inline-block",marginRight:"10px"},children:(0,s.jsxs)("div",{style:{width:"100px",height:"100px",borderRadius:"5px",border:"1px dashed #ccc",overflow:"hidden",position:"relative"},children:[(0,s.jsx)("img",{src:e,alt:"Uploaded",className:"my-0",style:{width:"100%",height:"100%",objectFit:"cover"}}),(0,s.jsx)("div",{style:{position:"absolute",top:"5px",right:"5px",cursor:"pointer"},onClick:()=>K(t),children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-x-circle",viewBox:"0 0 16 16",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14zM7.354 8l-2.88 2.879a.5.5 0 0 1-.708-.708L6.646 8 3.766 5.121a.5.5 0 0 1 .708-.708L8 7.354l2.879-2.88a.5.5 0 0 1 .708.708L8.354 8l2.879 2.879a.5.5 0 0 1-.708.708L8 8.354 5.121 11.233a.5.5 0 0 1-.708-.708L7.354 8z"})})})]})},t)),(0,s.jsx)("input",{type:"file",accept:"image/*",onChange:G,style:{display:"none"},id:"upload-button"}),(0,s.jsx)("div",{style:{width:"100px",height:"100px",borderRadius:"5px",border:"1px dashed #ccc",overflow:"hidden",cursor:"pointer",textAlign:"center",lineHeight:"100px"},className:"flex justify-center items-center"+(k.length>=r?" hidden":""),onClick:()=>{var e;null===(e=document.getElementById("upload-button"))||void 0===e||e.click()},children:(0,s.jsx)("div",{className:"text-4xl",children:"+"})})]}),(0,s.jsxs)("div",{className:"mt-10 flex justify-center space-x-4",children:[(0,s.jsx)("button",{className:"h-[40px] rounded-md bg-blue-500 px-4 py-1 text-sm font-medium text-white enabled:hover:bg-blue-600 disabled:opacity-50",onClick:A,disabled:y.trim().length<=0,children:c("Save & Submit")}),(0,s.jsx)("button",{className:"h-[40px] rounded-md border border-neutral-300 px-4 py-1 text-sm font-medium text-neutral-700 hover:bg-neutral-100 dark:border-neutral-700 dark:text-neutral-300 dark:hover:bg-neutral-800",onClick:()=>{Z(l.content),v(!1)},children:c("Cancel")})]})]}):(0,s.jsxs)("div",{className:"prose whitespace-pre-wrap dark:prose-invert flex-1",children:[z(l.content).text,(0,s.jsx)("div",{className:"flex items-center",children:z(l.content).imgList.map((e,t)=>(0,s.jsx)("div",{style:{marginRight:"10px",flex:1},children:(0,s.jsx)("img",{src:e,alt:"Uploaded"})},t))})]}),!g&&(0,s.jsxs)("div",{className:"md:-mr-8 ml-1 md:ml-0 flex flex-col md:flex-row gap-4 md:gap-1 items-center md:items-start justify-end md:justify-start",children:[(0,s.jsx)("button",{className:"invisible group-hover:visible focus:visible text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",onClick:L,children:(0,s.jsx)(B.Z,{size:20})}),(0,s.jsx)("button",{className:"invisible group-hover:visible focus:visible text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",onClick:P,children:(0,s.jsx)(Y.Z,{size:20})})]})]}):(0,s.jsxs)("div",{className:"flex flex-row",children:[(0,s.jsx)(en,{className:"prose dark:prose-invert flex-1",remarkPlugins:[ei.Z,ed.Z],rehypePlugins:[eo.Z],components:{code(e){let{node:t,inline:l,className:r,children:a,...n}=e;if(a.length){if("▍"==a[0])return(0,s.jsx)("span",{className:"animate-pulse cursor-default mt-1",children:"▍"});a[0]=a[0].replace("`▍`","▍")}let o=/language-(\w+)/.exec(r||"");return l?(0,s.jsx)("code",{className:r,...n,children:a}):(0,s.jsx)(ea,{language:o&&o[1]||"",value:String(a).replace(/\n$/,""),...n},Math.random())},table(e){let{children:t}=e;return(0,s.jsx)("table",{className:"border-collapse border border-black px-3 py-1 dark:border-white",children:t})},th(e){let{children:t}=e;return(0,s.jsx)("th",{className:"break-words border border-black bg-gray-500 px-3 py-1 text-white dark:border-white",children:t})},td(e){let{children:t}=e;return(0,s.jsx)("td",{className:"break-words border border-black px-3 py-1 dark:border-white",children:t})}},children:"".concat(l.content).concat(p&&a==(null!==(t=null==u?void 0:u.messages.length)&&void 0!==t?t:0)-1?"`▍`":"")}),(0,s.jsxs)("div",{className:"md:-mr-8 ml-1 md:ml-0 flex flex-col md:flex-row gap-4 md:gap-1 items-center md:items-start justify-end md:justify-start",children:[(0,s.jsx)("button",{className:"invisible group-hover:visible focus:visible text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",onClick:i,children:(0,s.jsx)(W.Z,{size:20})}),C?(0,s.jsx)(X.Z,{size:20,className:"text-green-500 dark:text-green-400"}):(0,s.jsx)("button",{className:"invisible group-hover:visible focus:visible text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",onClick:O,children:(0,s.jsx)(V.Z,{size:20})})]})]})})]})})});ec.displayName="ChatMessage";let eu=(0,n.memo)(ec,(e,t)=>e.message.content===t.message.content);var em=l(83454);class ex extends Error{constructor(e,t,l,r){super(e),this.name="OpenAIError",this.type=t,this.param=l,this.code=r}}let ep=async(e,t,l,r,a,s,n)=>{let o=await fetch("".concat(r,"/v1/chat/completions"),{headers:{"Content-Type":"application/json",..."openai"===g&&{Authorization:"Bearer ".concat(a||em.env.OPENAI_API_KEY)}},method:"POST",body:JSON.stringify({..."openai"===g&&{model:e.id},messages:[{role:"system",content:t},...s],max_tokens:1e3,temperature:l,stream:n})}),i=new TextDecoder;if(200!==o.status){let e=await o.json();if(e.error)throw new ex(e.error.message,e.error.type,e.error.param,e.error.code);throw Error("OpenAI API returned an error: ".concat(i.decode(null==e?void 0:e.value)||e.statusText))}return n?o.body:await o.json()},eh=(0,n.memo)(e=>{var t,l;let r,a;let{stopConversationRef:i}=e,{t:d}=(0,o.$G)("chat"),{state:{selectedConversation:c,conversations:u,models:m,isStream:x,lightMode:p,api:g,apiKey:v,pluginKeys:f,modelError:j,loading:k,prompts:N},handleUpdateConversation:C,dispatch:S}=(0,n.useContext)(_),[E,A]=(0,n.useState)(),[P,T]=(0,n.useState)(0),[z,O]=(0,n.useState)(!0),[Z,R]=(0,n.useState)(!1),[M,U]=(0,n.useState)(!1),$=(0,n.useRef)(null),B=(0,n.useRef)(null),Y=(0,n.useRef)(null),W=(0,n.useCallback)(async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(arguments.length>2&&void 0!==arguments[2]&&arguments[2],c){let l,r;if(t){let r=[...c.messages];for(let e=0;e<t;e++)r.pop();l={...c,messages:[...r,e]}}else l={...c,messages:[...c.messages,e]};S({field:"selectedConversation",value:l}),S({field:"loading",value:!0}),S({field:"messageIsStreaming",value:!0});let a={model:l.model,messages:l.messages,key:v,prompt:l.prompt,temperature:l.temperature},s=new AbortController;try{let{model:e,messages:t,key:l,prompt:s,temperature:n}=a,o=n;null==o&&(o=h);let i=[];for(let e=t.length-1;e>=0;e--){let l=t[e];i=[l,...i]}r=await ep(e,s,o,g,l,i,x)}catch(e){console.error(e),r=e instanceof ex?new Response("Error",{status:500,statusText:e.message}):new Response("Error",{status:500})}if(r){if(x){let e=r.getReader(),t=new TextDecoder,a=!1,n=!0,o=!0,i=[],d="",m="";for(;!a||0!==i.length;){let{value:r}=await e.read(),x=t.decode(r),p=RegExp("(?<=})(?={)","g"),h=x.split(p),g=[];for(let e of(h.forEach(e=>{let t=!1;if((e=e.trim()).startsWith("{")?e.endsWith("}")||(m=e,t=!0):m?(e=m+e,m=""):t=!0,!t)try{g.push(JSON.parse(e))}catch(t){console.log("error JSON",e)}}),g.forEach(e=>{e&&e.choices&&e.choices.forEach(e=>{e&&(e.finish_reason&&null!==e.finish_reason||e.delta&&e.delta.content&&"data: [DONE]"===e.delta.content?a=!0:!a&&e.delta&&e.delta.content&&i.push(e.delta.content))})}),i)){let e=i.shift();if(o?o=!1:await function(e){return new Promise(t=>setTimeout(t,e))}(Math.random()*(i.length<10?500:200)),d+=e,n){n=!1,S({field:"loading",value:!1});let e=[...l.messages,{role:"assistant",content:d}];S({field:"selectedConversation",value:l={...l,messages:e}})}else{let e=l.messages.map((e,t)=>t===l.messages.length-1?{...e,content:d}:e);w(l={...l,messages:e}),S({field:"selectedConversation",value:l});let t=u.map(e=>e.id===c.id?l:e);0===t.length&&t.push(l),S({field:"conversations",value:t}),y(t)}a&&0===i.length&&(S({field:"messageIsStreaming",value:!1}),s.abort())}}}else{let e=r.choices[0].message,t=[...l.messages,{role:"assistant",content:e.content}];l={...l,messages:t},console.log("updatedMessages"),S({field:"selectedConversation",value:b}),w(l);let a=u.map(e=>e.id===c.id?l:e);0===a.length&&a.push(l),S({field:"conversations",value:a}),y(a),S({field:"loading",value:!1}),S({field:"messageIsStreaming",value:!1}),S({field:"selectedConversation",value:l})}}}},[g,v,u,f,x,c,i]);(0,n.useCallback)(()=>{if(z){var e,t;null===(e=$.current)||void 0===e||e.scrollIntoView({behavior:"smooth"}),null===(t=Y.current)||void 0===t||t.focus()}},[z]);let X=()=>{if(B.current){let{scrollTop:e,scrollHeight:t,clientHeight:l}=B.current;e+l<t-30?(O(!1),U(!0)):(O(!0),U(!1))}},V=()=>{var e;null===(e=B.current)||void 0===e||e.scrollTo({top:B.current.scrollHeight,behavior:"smooth"})},q=()=>{R(!Z)},Q=()=>{confirm(d("Are you sure you want to clear all messages?"))&&c&&C(c,{key:"messages",value:[]})},ee=()=>{if(z){var e;null===(e=$.current)||void 0===e||e.scrollIntoView(!0)}},et=function(){for(var e=arguments.length,t=Array(e),l=0;l<e;l++)t[l]=arguments[l];a?(clearTimeout(r),r=setTimeout(()=>{Date.now()-a>=250&&(ee(...t),a=Date.now())},250-(Date.now()-a))):(ee(...t),a=Date.now())};return(0,n.useEffect)(()=>{et(),c&&(T(null==c?void 0:c.messages.reduce((e,t)=>(Array.isArray(t.content)&&(e+=t.content.reduce((e,t)=>("image_url"===t.type&&t.image_url&&e++,e),0)),e),0)),A(c.messages[c.messages.length-2]))},[c,et]),(0,n.useEffect)(()=>{let e=new IntersectionObserver(e=>{let[t]=e;if(O(t.isIntersecting),t.isIntersecting){var l;null===(l=Y.current)||void 0===l||l.focus()}},{root:null,threshold:.5}),t=$.current;return t&&e.observe(t),()=>{t&&e.unobserve(t)}},[$]),(0,s.jsx)("div",{className:"relative flex-1 overflow-hidden bg-white dark:bg-[#343541]",children:v||g?j?(0,s.jsx)(J,{error:j}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"max-h-full overflow-x-hidden",ref:B,onScroll:X,children:(null==c?void 0:null===(t=c.messages)||void 0===t?void 0:t.length)===0?(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("div",{className:"mx-auto flex flex-col space-y-5 md:space-y-10 px-3 pt-5 md:pt-12 sm:max-w-[600px]",children:[(0,s.jsx)("div",{className:"text-center text-3xl font-semibold text-gray-800 dark:text-gray-100",children:(null==m?void 0:m.length)===0?(0,s.jsx)("div",{children:(0,s.jsx)(K,{size:"16px",className:"mx-auto"})}):(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center"},children:[(0,s.jsx)("img",{style:{height:"4rem",marginRight:"2rem"},src:"dark"===p?"/GaiaNet-white.svg":"/GaiaNet-black.svg"}),"GaiaNet-AI Chat"]})}),(null==m?void 0:m.length)>0&&(0,s.jsxs)("div",{className:"flex h-full flex-col space-y-4 rounded-lg border border-neutral-200 p-4 dark:border-neutral-600",children:[(0,s.jsx)(H,{}),(null==c?void 0:c.promptState)!==2&&(0,s.jsx)(F,{conversation:c,prompts:N,onChangePrompt:e=>C(c,{key:"prompt",value:e})})]})]})}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"sticky top-0 z-10 flex justify-center border border-b-neutral-300 bg-neutral-100 py-2 text-sm text-neutral-500 dark:border-none dark:bg-[#444654] dark:text-neutral-200",children:[d("Model"),": ",null==c?void 0:null===(l=c.model)||void 0===l?void 0:l.id," | ",d("Temp"),": ",null==c?void 0:c.temperature," |",(0,s.jsx)("button",{className:"ml-2 cursor-pointer hover:opacity-50",onClick:q,children:(0,s.jsx)(I.Z,{size:18})}),(0,s.jsx)("button",{className:"ml-2 cursor-pointer hover:opacity-50",onClick:Q,children:(0,s.jsx)(L.Z,{size:18})})]}),Z&&(0,s.jsx)("div",{className:"flex flex-col space-y-10 md:mx-auto md:max-w-xl md:gap-6 md:py-3 md:pt-6 lg:max-w-2xl lg:px-0 xl:max-w-3xl",children:(0,s.jsx)("div",{className:"flex h-full flex-col space-y-4 border-b border-neutral-200 p-4 dark:border-neutral-600 md:rounded-lg md:border",children:(0,s.jsx)(H,{})})}),(null==c?void 0:c.messages)&&c.messages.map((e,t)=>(0,s.jsx)(eu,{message:e,messageIndex:t,maxImg:1-P,onRegenerate:()=>{E&&W(E,c.messages.length-t+1,null)},onEdit:e=>{A(e),W(e,(null==c?void 0:c.messages.length)-t)}},t)),k&&(0,s.jsx)(G,{}),(0,s.jsx)("div",{className:"h-[162px] bg-white dark:bg-[#343541]",ref:$})]})}),((null==c?void 0:c.promptState)!==1||(null==c?void 0:c.prompt)!=="")&&(0,s.jsx)(D,{maxImg:1-P,stopConversationRef:i,textareaRef:Y,onSend:(e,t)=>{A(e),W(e,0,t)},onScrollDownClick:V,onRegenerate:()=>{E&&W(E,2,null)},showScrollDownButton:M})]}):(0,s.jsxs)("div",{className:"mx-auto flex h-full w-[300px] flex-col justify-center space-y-6 sm:w-[600px]",children:[(0,s.jsx)("div",{className:"text-center text-4xl font-bold text-black dark:text-white",children:"Welcome to GaiaNet-AI Chat"}),(0,s.jsxs)("div",{className:"text-center text-gray-500 dark:text-gray-400",children:[(0,s.jsx)("div",{className:"mb-2",children:"GaiaNet-AI Chat allows you to plug in your API key to use this UI with their API."}),(0,s.jsxs)("div",{className:"mb-2",children:["It is ",(0,s.jsx)("span",{className:"italic",children:"only"})," used to communicate with their API."]})]})]})})});eh.displayName="Chat";let eg=()=>{let e=localStorage.getItem("conversationHistory"),t=localStorage.getItem("folders"),l=localStorage.getItem("prompts");e&&(e=JSON.parse(e)),t&&(t=JSON.parse(t)),l&&(l=JSON.parse(l));let r={version:4,history:e||[],folders:t||[],prompts:l||[]},a=new Blob([JSON.stringify(r,null,2)],{type:"application/json"}),s=URL.createObjectURL(a),n=document.createElement("a");n.download="chatbot_ui_history_".concat(function(){let e=new Date,t=e.getMonth()+1,l=e.getDate();return"".concat(t,"-").concat(l)}(),".json"),n.href=s,n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(s)},ev=e=>{let{history:t,folders:l,prompts:r}=function(e){if(Array.isArray(e))return{version:4,history:f(e),folders:[],prompts:[]};if(!("version"in e)&&"folders"in e&&"history"in e)return{version:4,history:f(e.history||[]),folders:(e.folders||[]).map(e=>({id:e.id.toString(),name:e.name,type:"chat"})),prompts:[]};if(3===e.version)return{...e,version:4,prompts:[]};if(4===e.version)return e;throw Error("Unsupported data format")}(e),a=localStorage.getItem("conversationHistory"),s=a?JSON.parse(a):[],n=[...s,...t].filter((e,t,l)=>t===l.findIndex(t=>t.id===e.id));localStorage.setItem("conversationHistory",JSON.stringify(n)),n.length>0?localStorage.setItem("selectedConversation",JSON.stringify(n[n.length-1])):localStorage.removeItem("selectedConversation");let o=localStorage.getItem("folders"),i=o?JSON.parse(o):[],d=[...i,...l].filter((e,t,l)=>t===l.findIndex(t=>t.id===e.id));localStorage.setItem("folders",JSON.stringify(d));let c=localStorage.getItem("prompts"),u=c?JSON.parse(c):[],m=[...u,...r].filter((e,t,l)=>t===l.findIndex(t=>t.id===e.id));return localStorage.setItem("prompts",JSON.stringify(m)),{version:4,history:n,folders:d,prompts:m}};var ef=l(87664),eb=l(62577),ew=l(97283),ey=l(30471);let ej=e=>{let{handleClick:t,children:l}=e;return(0,s.jsx)("button",{className:"min-w-[20px] p-1 text-neutral-400 hover:text-neutral-100",onClick:t,children:l})},ek=e=>{let{currentFolder:t,searchTerm:l,handleDrop:r,folderComponent:a}=e,{handleDeleteFolder:o,handleUpdateFolder:i}=(0,n.useContext)(_),[d,c]=(0,n.useState)(!1),[u,m]=(0,n.useState)(!1),[x,p]=(0,n.useState)(""),[h,g]=(0,n.useState)(!1),v=e=>{"Enter"===e.key&&(e.preventDefault(),f())},f=()=>{i(t.id,x),p(""),m(!1)},b=e=>{e.dataTransfer&&(g(!0),r(e,t),e.target.style.background="none")},w=e=>{e.preventDefault()},y=e=>{e.target.style.background="#343541"},j=e=>{e.target.style.background="none"};return(0,n.useEffect)(()=>{u?c(!1):d&&m(!1)},[u,d]),(0,n.useEffect)(()=>{l?g(!0):g(!1)},[l]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"relative flex items-center",children:[u?(0,s.jsxs)("div",{className:"flex w-full items-center gap-3 bg-[#343541]/90 p-3",children:[h?(0,s.jsx)(ef.Z,{size:18}):(0,s.jsx)(eb.Z,{size:18}),(0,s.jsx)("input",{className:"mr-12 flex-1 overflow-hidden overflow-ellipsis border-neutral-400 bg-transparent text-left text-[12.5px] leading-3 text-white outline-none focus:border-neutral-100",type:"text",value:x,onChange:e=>p(e.target.value),onKeyDown:v,autoFocus:!0})]}):(0,s.jsxs)("button",{className:"flex w-full cursor-pointer items-center gap-3 rounded-lg p-3 text-sm transition-colors duration-200 hover:bg-[#343541]/90",onClick:()=>g(!h),onDrop:e=>b(e),onDragOver:w,onDragEnter:y,onDragLeave:j,children:[h?(0,s.jsx)(ef.Z,{size:18}):(0,s.jsx)(eb.Z,{size:18}),(0,s.jsx)("div",{className:"relative max-h-5 flex-1 overflow-hidden text-ellipsis whitespace-nowrap break-all text-left text-[12.5px] leading-3",children:t.name})]}),(d||u)&&(0,s.jsxs)("div",{className:"absolute right-1 z-10 flex text-gray-300",children:[(0,s.jsx)(ej,{handleClick:e=>{e.stopPropagation(),d?o(t.id):u&&f(),c(!1),m(!1)},children:(0,s.jsx)(X.Z,{size:18})}),(0,s.jsx)(ej,{handleClick:e=>{e.stopPropagation(),c(!1),m(!1)},children:(0,s.jsx)(ew.Z,{size:18})})]}),!d&&!u&&(0,s.jsxs)("div",{className:"absolute right-1 z-10 flex text-gray-300",children:[(0,s.jsx)(ej,{handleClick:e=>{e.stopPropagation(),m(!0),p(t.name)},children:(0,s.jsx)(ey.Z,{size:18})}),(0,s.jsx)(ej,{handleClick:e=>{e.stopPropagation(),c(!0)},children:(0,s.jsx)(Y.Z,{size:18})})]})]}),h?a:null]})};var eN=l(47447);let eC=(0,n.createContext)(void 0),eS=e=>{let{conversation:t}=e,{state:{selectedConversation:l,messageIsStreaming:r},handleSelectConversation:a,handleUpdateConversation:o}=(0,n.useContext)(_),{handleDeleteConversation:i}=(0,n.useContext)(eC),[d,c]=(0,n.useState)(!1),[u,m]=(0,n.useState)(!1),[x,p]=(0,n.useState)(""),h=e=>{"Enter"===e.key&&(e.preventDefault(),l&&v(l))},g=(e,t)=>{e.dataTransfer&&e.dataTransfer.setData("conversation",JSON.stringify(t))},v=e=>{x.trim().length>0&&(o(e,{key:"name",value:x}),p(""),m(!1))},f=e=>{e.stopPropagation(),d?i(t):u&&v(t),c(!1),m(!1)},b=e=>{e.stopPropagation(),c(!1),m(!1)},w=e=>{e.stopPropagation(),m(!0),l&&p(l.name)},y=e=>{e.stopPropagation(),c(!0)};return(0,n.useEffect)(()=>{u?c(!1):d&&m(!1)},[u,d]),(0,s.jsxs)("div",{className:"relative flex items-center",children:[u&&(null==l?void 0:l.id)===t.id?(0,s.jsxs)("div",{className:"flex w-full items-center gap-3 rounded-lg bg-[#343541]/90 p-3",children:[(0,s.jsx)(eN.Z,{size:18}),(0,s.jsx)("input",{className:"mr-12 flex-1 overflow-hidden overflow-ellipsis border-neutral-400 bg-transparent text-left text-[12.5px] leading-3 text-white outline-none focus:border-neutral-100",type:"text",value:x,onChange:e=>p(e.target.value),onKeyDown:h,autoFocus:!0})]}):(0,s.jsxs)("button",{className:"flex w-full cursor-pointer items-center gap-3 rounded-lg p-3 text-sm transition-colors duration-200 hover:bg-[#343541]/90 ".concat(r?"disabled:cursor-not-allowed":""," ").concat((null==l?void 0:l.id)===t.id?"bg-[#343541]/90":""),onClick:()=>a(t),disabled:r,draggable:"true",onDragStart:e=>g(e,t),children:[(0,s.jsx)(eN.Z,{size:18}),(0,s.jsx)("div",{className:"relative max-h-5 flex-1 overflow-hidden text-ellipsis whitespace-nowrap break-all text-left text-[12.5px] leading-3 ".concat((null==l?void 0:l.id)===t.id?"pr-12":"pr-1"),children:t.name})]}),(d||u)&&(null==l?void 0:l.id)===t.id&&(0,s.jsxs)("div",{className:"absolute right-1 z-10 flex text-gray-300",children:[(0,s.jsx)(ej,{handleClick:f,children:(0,s.jsx)(X.Z,{size:18})}),(0,s.jsx)(ej,{handleClick:b,children:(0,s.jsx)(ew.Z,{size:18})})]}),(null==l?void 0:l.id)===t.id&&!d&&!u&&(0,s.jsxs)("div",{className:"absolute right-1 z-10 flex text-gray-300",children:[(0,s.jsx)(ej,{handleClick:w,children:(0,s.jsx)(ey.Z,{size:18})}),(0,s.jsx)(ej,{handleClick:y,children:(0,s.jsx)(Y.Z,{size:18})})]})]})},eI=e=>{let{searchTerm:t}=e,{state:{folders:l,conversations:r},handleUpdateConversation:a}=(0,n.useContext)(_),o=(e,t)=>{if(e.dataTransfer){let l=JSON.parse(e.dataTransfer.getData("conversation"));a(l,{key:"folderId",value:t.id})}},i=e=>r&&r.filter(e=>e.folderId).map((t,l)=>{if(t.folderId===e.id)return(0,s.jsx)("div",{className:"ml-5 gap-2 border-l pl-2",children:(0,s.jsx)(eS,{conversation:t})},l)});return(0,s.jsx)("div",{className:"flex w-full flex-col pt-2",children:l.filter(e=>"chat"===e.type).sort((e,t)=>e.name.localeCompare(t.name)).map((e,l)=>(0,s.jsx)(ek,{searchTerm:t,currentFolder:e,handleDrop:o,folderComponent:i(e)},l))})};var eL=l(17248),e_=l(3742);let eE=e=>{let{open:t,onClose:l}=e,{t:r}=(0,o.$G)("settings"),a=C(),{state:i,dispatch:d}=c({initialState:a}),{dispatch:u}=(0,n.useContext)(_),m=(0,n.useRef)(null);(0,n.useEffect)(()=>{let e=e=>{m.current&&!m.current.contains(e.target)&&window.addEventListener("mouseup",t)},t=e=>{window.removeEventListener("mouseup",t),l()};return window.addEventListener("mousedown",e),()=>{window.removeEventListener("mousedown",e)}},[l]);let x=()=>{u({field:"lightMode",value:i.theme}),u({field:"isStream",value:i.isStream}),console.log(i.isStream),S(i)};return t?(0,s.jsx)("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50",children:(0,s.jsx)("div",{className:"fixed inset-0 z-10 overflow-hidden",children:(0,s.jsxs)("div",{className:"flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0",children:[(0,s.jsx)("div",{className:"hidden sm:inline-block sm:h-screen sm:align-middle","aria-hidden":"true"}),(0,s.jsxs)("div",{ref:m,className:"dark:border-netural-400 inline-block max-h-[400px] transform overflow-y-auto rounded-lg border border-gray-300 bg-white px-4 pt-5 pb-4 text-left align-bottom shadow-xl transition-all dark:bg-[#202123] sm:my-8 sm:max-h-[600px] sm:w-full sm:max-w-lg sm:p-6 sm:align-middle",role:"dialog",children:[(0,s.jsx)("div",{className:"text-lg pb-4 font-bold text-black dark:text-neutral-200",children:r("Settings")}),(0,s.jsx)("div",{className:"text-sm font-bold mb-2 text-black dark:text-neutral-200",children:r("Theme")}),(0,s.jsxs)("select",{className:"w-full cursor-pointer bg-transparent p-2 text-neutral-700 dark:text-neutral-200",value:i.theme,onChange:e=>d({field:"theme",value:e.target.value}),children:[(0,s.jsx)("option",{value:"dark",children:r("Dark mode")}),(0,s.jsx)("option",{value:"light",children:r("Light mode")})]}),(0,s.jsx)("div",{className:"text-sm font-bold mb-2 text-black dark:text-neutral-200",children:r("Output type")}),(0,s.jsxs)("select",{className:"w-full cursor-pointer bg-transparent p-2 text-neutral-700 dark:text-neutral-200",value:i.isStream.toString(),onChange:e=>{console.log(e.target.value),d({field:"isStream",value:"true"===e.target.value})},children:[(0,s.jsx)("option",{value:"false",children:r("Completed output")}),(0,s.jsx)("option",{value:"true",children:r("Streaming output")})]}),(0,s.jsx)("button",{type:"button",className:"w-full px-4 py-2 mt-6 border rounded-lg shadow border-neutral-500 text-neutral-900 hover:bg-neutral-100 focus:outline-none dark:border-neutral-800 dark:border-opacity-50 dark:bg-white dark:text-black dark:hover:bg-neutral-300",onClick:()=>{x(),l()},children:r("Save")})]})]})})}):(0,s.jsx)(s.Fragment,{})};var eA=l(47083);let eP=e=>{let{text:t,icon:l,onClick:r}=e;return(0,s.jsxs)("button",{className:"flex w-full cursor-pointer select-none items-center gap-3 rounded-md py-3 px-3 text-[14px] leading-3 text-white transition-colors duration-200 hover:bg-gray-500/10",onClick:r,children:[(0,s.jsx)("div",{children:l}),(0,s.jsx)("span",{children:t})]})},eT=e=>{let{api:t,onApiChange:l}=e,{t:r}=(0,o.$G)("sidebar"),[a,i]=(0,n.useState)(!1),[d,c]=(0,n.useState)(t),u=(0,n.useRef)(null),m=e=>{"Enter"===e.key&&(e.preventDefault(),x(d))},x=e=>{l(e.trim()),i(!1)};return(0,n.useEffect)(()=>{if(a){var e;null===(e=u.current)||void 0===e||e.focus()}},[a]),a?(0,s.jsxs)("div",{className:"duration:200 flex w-full cursor-pointer items-center rounded-md py-3 px-3 transition-colors hover:bg-gray-500/10",children:[(0,s.jsx)(eA.Z,{size:18}),(0,s.jsx)("input",{ref:u,className:"ml-2 h-[20px] flex-1 overflow-hidden overflow-ellipsis border-b border-neutral-400 bg-transparent pr-1 text-[12.5px] leading-3 text-left text-white outline-none focus:border-neutral-100",value:d,onChange:e=>c(e.target.value),onKeyDown:m,placeholder:r("API Url")||"API Url"}),(0,s.jsxs)("div",{className:"flex w-[40px]",children:[(0,s.jsx)(X.Z,{className:"ml-auto min-w-[20px] text-neutral-400 hover:text-neutral-100",size:18,onClick:e=>{e.stopPropagation(),x(d)}}),(0,s.jsx)(ew.Z,{className:"ml-auto min-w-[20px] text-neutral-400 hover:text-neutral-100",size:18,onClick:e=>{e.stopPropagation(),i(!1),c(t)}})]})]}):(0,s.jsx)(eP,{text:r("Chat API Url"),icon:(0,s.jsx)(eA.Z,{size:18}),onClick:()=>i(!0)})},ez=e=>{let{onClearConversations:t}=e,[l,r]=(0,n.useState)(!1),{t:a}=(0,o.$G)("sidebar"),i=()=>{t(),r(!1)};return l?(0,s.jsxs)("div",{className:"flex w-full cursor-pointer items-center rounded-lg py-3 px-3 hover:bg-gray-500/10",children:[(0,s.jsx)(Y.Z,{size:18}),(0,s.jsx)("div",{className:"ml-3 flex-1 text-left text-[12.5px] leading-3 text-white",children:a("Are you sure?")}),(0,s.jsxs)("div",{className:"flex w-[40px]",children:[(0,s.jsx)(X.Z,{className:"ml-auto mr-1 min-w-[20px] text-neutral-400 hover:text-neutral-100",size:18,onClick:e=>{e.stopPropagation(),i()}}),(0,s.jsx)(ew.Z,{className:"ml-auto min-w-[20px] text-neutral-400 hover:text-neutral-100",size:18,onClick:e=>{e.stopPropagation(),r(!1)}})]})]}):(0,s.jsx)(eP,{text:a("Clear conversations"),icon:(0,s.jsx)(Y.Z,{size:18}),onClick:()=>r(!0)})},eO=()=>{let{t:e}=(0,o.$G)("sidebar"),[t,l]=(0,n.useState)(!1),{state:{api:r,apiKey:a,lightMode:i,serverSideApiKeyIsSet:d,serverSidePluginKeysSet:c,conversations:u},dispatch:m}=(0,n.useContext)(_),{handleClearConversations:x,handleImportConversations:p,handleExportData:h,handleApiChange:g,handleApiKeyChange:v}=(0,n.useContext)(eC);return(0,s.jsxs)("div",{className:"flex flex-col items-center space-y-1 border-t border-white/20 pt-1 text-sm",children:[u.length>0?(0,s.jsx)(ez,{onClearConversations:x}):null,(0,s.jsx)(eP,{text:"Follow us on twitter",icon:(0,s.jsx)(eL.Z,{size:18}),onClick:()=>window.open("https://twitter.com/gaianet_ai","_blank")}),(0,s.jsx)(eP,{text:"GitHub",icon:(0,s.jsx)(e_.Z,{size:18}),onClick:()=>window.open("https://github.com/GaiaNet-AI","_blank")}),(0,s.jsx)(eP,{text:"Huggingface",icon:(0,s.jsx)(R.Z,{size:18}),onClick:()=>window.open("https://huggingface.co/gaianet","_blank")}),(0,s.jsx)(eP,{text:e("Settings"),icon:(0,s.jsx)(I.Z,{size:18}),onClick:()=>l(!0)}),(0,s.jsx)(eT,{api:r,onApiChange:g}),(0,s.jsx)(eE,{open:t,onClose:()=>{l(!1)}})]})},eZ=e=>{let{conversations:t}=e;return(0,s.jsx)("div",{className:"flex w-full flex-col gap-1",children:t.filter(e=>!e.folderId).slice().reverse().map((e,t)=>(0,s.jsx)(eS,{conversation:e},t))})};var eD=l(1177),eR=l(16745),eG=l(92005),eK=l(67421),eM=l(98963),eJ=l(89014);let eU=e=>{let{onClick:t,side:l}=e;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("button",{className:"fixed top-5 ".concat("right"===l?"right-[270px]":"left-[270px]"," z-50 h-7 w-7 hover:text-gray-400 dark:text-white dark:hover:text-gray-300 sm:top-0.5 sm:").concat("right"===l?"right-[270px]":"left-[270px]"," sm:h-8 sm:w-8 sm:text-neutral-700"),onClick:t,children:"right"===l?(0,s.jsx)(eM.Z,{}):(0,s.jsx)(eJ.Z,{})}),(0,s.jsx)("div",{onClick:t,className:"absolute top-0 left-0 z-10 h-full w-full bg-black opacity-70 sm:hidden"})]})},eH=e=>{let{onClick:t,side:l}=e;return(0,s.jsx)("button",{className:"fixed top-2.5 ".concat("right"===l?"right-2":"left-2"," z-50 h-7 w-7 text-white hover:text-gray-400 dark:text-white dark:hover:text-gray-300 sm:top-0.5 sm:").concat("right"===l?"right-2":"left-2"," sm:h-8 sm:w-8 sm:text-neutral-700"),onClick:t,children:"right"===l?(0,s.jsx)(eJ.Z,{}):(0,s.jsx)(eM.Z,{})})},eF=e=>{let{placeholder:t,searchTerm:l,onSearch:r}=e,{t:a}=(0,o.$G)("sidebar"),n=e=>{r(e.target.value)},i=()=>{r("")};return(0,s.jsxs)("div",{className:"relative flex items-center",children:[(0,s.jsx)("input",{className:"w-full flex-1 rounded-md border border-neutral-600 bg-[#202123] px-4 py-3 pr-10 text-[14px] leading-3 text-white",type:"text",placeholder:a(t)||"",value:l,onChange:n}),l&&(0,s.jsx)(ew.Z,{className:"absolute right-4 cursor-pointer text-neutral-300 hover:text-neutral-400",size:18,onClick:i})]})},e$=e=>{let{isOpen:t,addItemButtonTitle:l,canCreateChat:r,side:a,items:n,itemComponent:o,folderComponent:i,footerComponent:d,searchTerm:c,handleSearchTerm:u,toggleOpen:m,handleCreateItem:x,handleCreateFolder:p,handleDrop:h}=e,{t:g}=(0,eK.$G)("promptbar"),v=e=>{e.preventDefault()},f=e=>{e.target.style.background="#343541"},b=e=>{e.target.style.background="none"};return t?(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"fixed top-0 ".concat(a,"-0 z-40 flex h-full w-[260px] flex-none flex-col space-y-2 bg-[#202123] p-2 text-[14px] transition-all sm:relative sm:top-0"),children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsxs)("button",{disabled:!r,className:"text-sidebar flex w-[190px] flex-shrink-0 select-none items-center gap-3 rounded-md border border-white/20 p-3 text-white transition-colors duration-200 hover:bg-gray-500/10 "+(r?"cursor-pointer":"cursor-not-allowed"),onClick:()=>{x(),u("")},children:[(0,s.jsx)(eD.Z,{size:16}),l]}),(0,s.jsx)("button",{disabled:!r,className:"ml-2 flex flex-shrink-0 items-center gap-3 rounded-md border border-white/20 p-3 text-sm text-white transition-colors duration-200 hover:bg-gray-500/10 "+(r?"cursor-pointer":"cursor-not-allowed"),onClick:p,children:(0,s.jsx)(eR.Z,{size:16})})]}),(0,s.jsx)(eF,{placeholder:g("Search...")||"",searchTerm:c,onSearch:u}),(0,s.jsxs)("div",{className:"flex-grow overflow-auto",children:[(null==n?void 0:n.length)>0&&(0,s.jsx)("div",{className:"flex border-b border-white/20 pb-2",children:i}),(null==n?void 0:n.length)>0?(0,s.jsx)("div",{className:"pt-2",onDrop:h,onDragOver:v,onDragEnter:f,onDragLeave:b,children:o}):(0,s.jsxs)("div",{className:"mt-8 select-none text-center text-white opacity-50",children:[(0,s.jsx)(eG.Z,{className:"mx-auto mb-3"}),(0,s.jsx)("span",{className:"text-[14px] leading-normal",children:g("No data.")})]})]}),d]}),(0,s.jsx)(eU,{onClick:m,side:a})]}):(0,s.jsx)(eH,{onClick:m,side:a})},eB={searchTerm:"",filteredConversations:[]};var eY=l(57632);let eW=()=>{let{t:e}=(0,o.$G)("sidebar"),t=c({initialState:eB}),{state:{conversations:l,showChatbar:r,models:a,folders:i,pluginKeys:d},dispatch:u,handleCreateFolder:m,handleNewConversation:x,handleUpdateConversation:p}=(0,n.useContext)(_),{state:{searchTerm:g,filteredConversations:v},dispatch:f}=t,b=(0,n.useCallback)(e=>{u({field:"api",value:e}),localStorage.setItem("api",e)},[u]),k=(0,n.useCallback)(e=>{u({field:"apiKey",value:e}),localStorage.setItem("apiKey",e)},[u]),N=e=>{if(d.some(t=>t.pluginId===e.pluginId)){let t=d.map(t=>t.pluginId===e.pluginId?e:t);u({field:"pluginKeys",value:t}),localStorage.setItem("pluginKeys",JSON.stringify(t))}else u({field:"pluginKeys",value:[...d,e]}),localStorage.setItem("pluginKeys",JSON.stringify([...d,e]))},C=e=>{let t=d.filter(t=>t.pluginId!==e.pluginId);if(0===t.length){u({field:"pluginKeys",value:[]}),localStorage.removeItem("pluginKeys");return}u({field:"pluginKeys",value:t}),localStorage.setItem("pluginKeys",JSON.stringify(t))},S=()=>{eg()},I=e=>{let{history:t,folders:l,prompts:r}=ev(e);u({field:"conversations",value:t}),u({field:"selectedConversation",value:t[t.length-1]}),u({field:"folders",value:l}),u({field:"prompts",value:r}),window.location.reload()},L=()=>{if(a&&a.length>0){var t,l;u({field:"selectedConversation",value:{id:(0,eY.Z)(),name:e("New Conversation"),messages:[],model:a[0],prompt:(null===(t=U.find(e=>{var t,l;return(null===(t=e.id)||void 0===t?void 0:t.toLowerCase())===(null===(l=a[0].name)||void 0===l?void 0:l.toLowerCase())}))||void 0===t?void 0:t.content)||"",promptState:(null===(l=U.find(e=>{var t,l;return(null===(t=e.id)||void 0===t?void 0:t.toLowerCase())===(null===(l=a[0].name)||void 0===l?void 0:l.toLowerCase())}))||void 0===l?void 0:l.controlState)||0,temperature:h,folderId:null}})}u({field:"conversations",value:[]}),localStorage.removeItem("conversationHistory"),localStorage.removeItem("selectedConversation");let r=i.filter(e=>"chat"!==e.type);u({field:"folders",value:r}),j(r)},E=t=>{let r=l.filter(e=>e.id!==t.id);if(u({field:"conversations",value:r}),f({field:"searchTerm",value:""}),y(r),r.length>0)u({field:"selectedConversation",value:r[r.length-1]}),w(r[r.length-1]);else{if(a&&a.length>0){var s,n;u({field:"selectedConversation",value:{id:(0,eY.Z)(),name:e("New Conversation"),messages:[],model:a[0],prompt:(null===(s=U.find(e=>{var t,l;return(null===(t=e.id)||void 0===t?void 0:t.toLowerCase())===(null===(l=a[0].name)||void 0===l?void 0:l.toLowerCase())}))||void 0===s?void 0:s.content)||"",promptState:(null===(n=U.find(e=>{var t,l;return(null===(t=e.id)||void 0===t?void 0:t.toLowerCase())===(null===(l=a[0].name)||void 0===l?void 0:l.toLowerCase())}))||void 0===n?void 0:n.controlState)||0,temperature:h,folderId:null}})}localStorage.removeItem("selectedConversation")}},A=()=>{u({field:"showChatbar",value:!r}),localStorage.setItem("showChatbar",JSON.stringify(!r))},P=e=>{if(e.dataTransfer){let t=JSON.parse(e.dataTransfer.getData("conversation"));p(t,{key:"folderId",value:0}),f({field:"searchTerm",value:""}),e.target.style.background="none"}};return(0,n.useEffect)(()=>{g?f({field:"filteredConversations",value:l.filter(e=>{let t=e.name.toLocaleLowerCase()+" "+e.messages.map(e=>e.content).join(" ");return t.toLowerCase().includes(g.toLowerCase())})}):f({field:"filteredConversations",value:l})},[g,l]),(0,s.jsx)(eC.Provider,{value:{...t,handleDeleteConversation:E,handleClearConversations:L,handleImportConversations:I,handleExportData:S,handlePluginKeyChange:N,handleClearPluginKey:C,handleApiChange:b,handleApiKeyChange:k},children:(0,s.jsx)(e$,{side:"left",isOpen:r,canCreateChat:a&&a.length>0,addItemButtonTitle:e("New chat"),itemComponent:(0,s.jsx)(eZ,{conversations:v}),folderComponent:(0,s.jsx)(eI,{searchTerm:g}),items:v,searchTerm:g,handleSearchTerm:e=>f({field:"searchTerm",value:e}),toggleOpen:A,handleCreateItem:x,handleCreateFolder:()=>m(e("New folder"),"chat"),handleDrop:P,footerComponent:(0,s.jsx)(eO,{})})})},eX=e=>{let{selectedConversation:t,onNewConversation:l}=e;return(0,s.jsxs)("nav",{className:"flex w-full justify-between bg-[#202123] py-3 px-4",children:[(0,s.jsx)("div",{className:"mr-4"}),(0,s.jsx)("div",{className:"max-w-[240px] overflow-hidden text-ellipsis whitespace-nowrap",children:t.name}),(0,s.jsx)(eD.Z,{className:"cursor-pointer hover:text-neutral-400 mr-8",onClick:l})]})},eV={api:"..",apiKey:"",loading:!1,pluginKeys:[],lightMode:"dark",isStream:!0,messageIsStreaming:!1,modelError:null,models:[],folders:[],conversations:[],selectedConversation:void 0,currentMessage:void 0,prompts:[],temperature:1,showPromptbar:!0,showChatbar:!0,currentFolder:void 0,messageError:!1,searchTerm:"",defaultModelId:void 0,serverSideApiKeyIsSet:!1,serverSidePluginKeysSet:!1},eq=e=>{let t,{serverSideApiKeyIsSet:l,serverSidePluginKeysSet:r,defaultModelId:a}=e,{t:i}=(0,o.$G)("chat"),{getModels:u}=m(),x=c({initialState:eV}),{state:{api:p,apiKey:g,lightMode:N,folders:S,conversations:I,selectedConversation:L,prompts:E,models:A},dispatch:P}=x,T=(0,n.useRef)(!1),z=async()=>{t=await u({url:p,key:g}),P&&P({field:"models",value:t})};(0,n.useEffect)(()=>{A&&(!I||I&&0===I.length)&&G&&G()},[A]),(0,n.useEffect)(()=>{p&&z()},[p,g]);let O=e=>{P({field:"selectedConversation",value:e}),w(e)},Z=(e,t)=>{let l={id:(0,eY.Z)(),name:e,type:t},r=[...S,l];P({field:"folders",value:r}),j(r)},D=e=>{let t=S.filter(t=>t.id!==e);P({field:"folders",value:t}),j(t);let l=I.map(t=>t.folderId===e?{...t,folderId:null}:t);P({field:"conversations",value:l}),y(l);let r=E.map(t=>t.folderId===e?{...t,folderId:null}:t);P({field:"prompts",value:r}),k(r)},R=(e,t)=>{let l=S.map(l=>l.id===e?{...l,name:t}:l);P({field:"folders",value:l}),j(l)},G=()=>{let e=I[I.length-1];if(A&&A.length>0){var t,l,r;let a={id:(0,eY.Z)(),name:i("New Conversation"),messages:[],model:(null==e?void 0:e.model)||A[0],prompt:(null===(t=U.find(e=>{var t,l;return(null===(t=e.id)||void 0===t?void 0:t.toLowerCase())===(null===(l=A[0].name)||void 0===l?void 0:l.toLowerCase())}))||void 0===t?void 0:t.content)||"",promptState:(null===(l=U.find(e=>{var t,l;return(null===(t=e.id)||void 0===t?void 0:t.toLowerCase())===(null===(l=A[0].name)||void 0===l?void 0:l.toLowerCase())}))||void 0===l?void 0:l.controlState)||0,temperature:null!==(r=null==e?void 0:e.temperature)&&void 0!==r?r:h,folderId:null},s=[...I,a];P({field:"selectedConversation",value:a}),P({field:"conversations",value:s}),w(a),y(s),P({field:"loading",value:!1})}},K=(e,t)=>{let l={...e,[t.key]:t.value},{single:r,all:a}=b(l,I);P({field:"selectedConversation",value:r}),P({field:"conversations",value:a})},M=(e,t)=>{let l=Object.assign(e);t.forEach(e=>{l[e.key]=e.value});let{single:r,all:a}=b(l,I);P({field:"selectedConversation",value:r}),P({field:"conversations",value:a})};return(0,n.useEffect)(()=>{window.innerWidth<640&&P({field:"showChatbar",value:!1})},[L]),(0,n.useEffect)(()=>{l&&P({field:"serverSideApiKeyIsSet",value:l}),r&&P({field:"serverSidePluginKeysSet",value:r})},[l,r]),(0,n.useEffect)(()=>{var e,t,a,s,n;let o=C();o.theme&&P({field:"lightMode",value:o.theme}),o.isStream&&P({field:"isStream",value:o.isStream});let d=localStorage.getItem("api"),c=localStorage.getItem("apiKey");l?(P({field:"apiKey",value:""}),localStorage.removeItem("apiKey")):c&&P({field:"apiKey",value:c}),d&&P({field:"api",value:d});let u=localStorage.getItem("pluginKeys");r?(P({field:"pluginKeys",value:[]}),localStorage.removeItem("pluginKeys")):u&&P({field:"pluginKeys",value:u}),window.innerWidth<640&&P({field:"showChatbar",value:!1});let m=localStorage.getItem("showChatbar");m&&P({field:"showChatbar",value:"true"===m});let x=localStorage.getItem("folders");x&&P({field:"folders",value:JSON.parse(x)});let p=localStorage.getItem("prompts");p&&P({field:"prompts",value:JSON.parse(p)});let g=localStorage.getItem("conversationHistory");if(g){let e=JSON.parse(g),t=f(e);P({field:"conversations",value:t})}let b=localStorage.getItem("selectedConversation");if(b){let l=JSON.parse(b),r=v(l);if(r.model&&A&&A.length>0){let l=A.filter(e=>e.id===r.model.id);l&&0!==l.length||(r.model=A[0],r.prompt=(null===(e=U.find(e=>{var t,l,r;return(null===(t=e.id)||void 0===t?void 0:t.toLowerCase())===(null===(l=A[0])||void 0===l?void 0:null===(r=l.name)||void 0===r?void 0:r.toLowerCase())}))||void 0===e?void 0:e.content)||"",r.promptState=(null===(t=U.find(e=>{var t,l,r;return(null===(t=e.id)||void 0===t?void 0:t.toLowerCase())===(null===(l=A[0])||void 0===l?void 0:null===(r=l.name)||void 0===r?void 0:r.toLowerCase())}))||void 0===t?void 0:t.controlState)||0)}P({field:"selectedConversation",value:r})}else{let e=I[I.length-1],t={id:(0,eY.Z)(),name:i("New Conversation"),messages:[],temperature:null!==(a=null==e?void 0:e.temperature)&&void 0!==a?a:h,folderId:null};A&&A.length>0&&(t.model=A[0],t.prompt=(null===(s=U.find(e=>{var t,l,r;return(null===(t=e.id)||void 0===t?void 0:t.toLowerCase())===(null===(l=A[0])||void 0===l?void 0:null===(r=l.name)||void 0===r?void 0:r.toLowerCase())}))||void 0===s?void 0:s.content)||"",t.promptState=(null===(n=U.find(e=>{var t,l,r;return(null===(t=e.id)||void 0===t?void 0:t.toLowerCase())===(null===(l=A[0])||void 0===l?void 0:null===(r=l.name)||void 0===r?void 0:r.toLowerCase())}))||void 0===n?void 0:n.controlState)||0),P({field:"selectedConversation",value:t})}},[P,A,l,r]),(0,s.jsxs)(_.Provider,{value:{...x,handleNewConversation:G,handleCreateFolder:Z,handleDeleteFolder:D,handleUpdateFolder:R,handleSelectConversation:O,handleUpdateConversation:K,handleUpdateConversationAll:M},children:[(0,s.jsxs)(d(),{children:[(0,s.jsx)("title",{children:"GaiaNet-AI Chat"}),(0,s.jsx)("meta",{name:"description",content:"ChatGPT but better."}),(0,s.jsx)("meta",{name:"viewport",content:"height=device-height ,width=device-width, initial-scale=1, user-scalable=no"}),(0,s.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),L&&(0,s.jsxs)("main",{className:"flex h-screen w-screen flex-col text-sm text-white dark:text-white ".concat(N),children:[(0,s.jsx)("div",{className:"fixed top-0 w-full sm:hidden",children:(0,s.jsx)(eX,{selectedConversation:L,onNewConversation:G})}),(0,s.jsxs)("div",{className:"flex h-full w-full pt-[48px] sm:pt-0",children:[(0,s.jsx)(eW,{}),(0,s.jsx)("div",{className:"flex flex-1",children:(0,s.jsx)(eh,{stopConversationRef:T})})]})]})]})};var eQ=eq,e0=!0}},function(e){e.O(0,[879,306,774,888,179],function(){return e(e.s=48312)}),_N_E=e.O()}]);